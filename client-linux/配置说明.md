# 客户端配置说明

## 📋 必需配置

### 1. 服务端URL（必需）

服务端地址：`101.32.22.185`

**配置方式：**

#### 方式1: 首次运行时输入（推荐）
```bash
python run_client.py
# 会提示输入服务端URL，输入: http://101.32.22.185:8000
```

#### 方式2: 环境变量
```bash
# Linux/Mac
export PMS_SERVER_URL=http://101.32.22.185:8000

# Windows CMD
set PMS_SERVER_URL=http://101.32.22.185:8000

# Windows PowerShell
$env:PMS_SERVER_URL="http://101.32.22.185:8000"
```

#### 方式3: 配置文件
编辑 `client/data/client/config.json`:
```json
{
  "client_id": "client-1",
  "server_url": "http://101.32.22.185:8000"
}
```

### 2. 客户端ID（必需）

唯一标识，例如：`client-1`、`client-2`

**配置方式：**
- 首次运行时会提示输入
- 或使用环境变量：`export PMS_CLIENT_ID=client-1`

## 🔧 可选配置

### 客户端公网IP（重要）

**何时需要配置：**
- 客户端在服务器上运行
- 服务端需要通过公网访问客户端
- 自动检测的IP是内网IP，服务端无法访问

**配置方式：**

#### 方式1: 首次运行时输入
首次运行时会询问是否设置客户端公网IP

#### 方式2: 环境变量
```bash
export PMS_CLIENT_IP=your-client-public-ip
```

#### 方式3: 配置文件
编辑 `client/data/client/config.json`:
```json
{
  "client_id": "client-1",
  "server_url": "http://101.32.22.185:8000",
  "client_ip": "your-client-public-ip"
}
```

**注意：**
- 如果客户端在服务器上，`client_ip` 应该是服务器的公网IP
- 如果客户端在本地，且服务端在同一网络，可以留空使用自动检测

### 客户端端口（可选）

默认端口：`9000`

如需修改，编辑 `client/app.py` 中的 `CLIENT_PORT`

## 📝 配置示例

### 场景1: 客户端在服务器上，服务端在远程

```json
{
  "client_id": "client-server-01",
  "server_url": "http://101.32.22.185:8000",
  "client_ip": "your-server-public-ip"
}
```

### 场景2: 客户端在本地，服务端在远程

```json
{
  "client_id": "client-local-01",
  "server_url": "http://101.32.22.185:8000",
  "client_ip": ""  // 留空，使用自动检测（通常是内网IP，如果服务端无法访问，需要配置公网IP或使用VPN/内网穿透）
}
```

## ⚠️ 重要提示

### 防火墙设置

确保客户端端口（默认9000）可以被服务端访问：

```bash
# Linux (ufw)
sudo ufw allow 9000/tcp

# Linux (iptables)
sudo iptables -A INPUT -p tcp --dport 9000 -j ACCEPT

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=9000/tcp
sudo firewall-cmd --reload
```

### 网络连通性测试

1. **测试服务端是否可达**：
   ```bash
   curl http://101.32.22.185:8000/api/clients
   ```

2. **测试客户端端口是否开放**：
   ```bash
   # 在服务端执行
   curl http://your-client-ip:9000/api/health
   ```

3. **检查客户端注册**：
   - 访问服务端 Web 界面
   - 查看"客户端管理"面板
   - 应该能看到新注册的客户端

## 🔍 配置文件位置

配置文件位置：`client/data/client/config.json`

首次运行后会自动创建，格式：
```json
{
  "client_id": "client-1",
  "server_url": "http://101.32.22.185:8000",
  "client_ip": "optional-public-ip"
}
```

## 🛠️ 故障排查

### 问题1: 无法连接到服务端

**检查：**
1. 服务端URL是否正确：`http://101.32.22.185:8000`
2. 服务端是否运行
3. 网络是否可达：`ping 101.32.22.185`
4. 防火墙是否开放端口8000

### 问题2: 服务端无法访问客户端

**检查：**
1. 客户端IP配置是否正确（应该是公网IP）
2. 客户端端口是否开放（默认9000）
3. 防火墙是否允许访问
4. 网络是否可达

### 问题3: 客户端注册失败

**检查：**
1. 服务端URL配置是否正确
2. 客户端ID是否唯一
3. 客户端URL是否正确（应该是服务端能访问到的地址）
4. 查看客户端日志中的错误信息

